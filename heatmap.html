<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scheduled CI Status</title>
    <link href="https://unpkg.com/gridjs/dist/theme/mermaid.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="./rawData.js"></script>
    <style>
        body { font-family: sans-serif; justify-content: center; padding: 20px; }
        .container { 
          display: flex;
          justify-content: center;
          align-items: center;
          height: 500px;
          width: 100%
        }
        #chart {
          width: 100%; 
          max-width: 800px;
        }
        .pie {
          width: 30px;
          height: 30px;
          border-radius: 50%;
          background: conic-gradient(
            red 0% 50%,
            green 50% 100%
          );
        }
    </style>
</head>
<body>
    <h2>Scheduled CI Status</h2>
    <div class="container">
      <div id="chart"></div>
    </div>
    <script>
        // Helper function to generate random data for the heatmap
      
        var options = {
          series: rawChartData,
          chart: {
          height: 400,
          type: 'heatmap',
            events: {
                dataPointSelection: function(event, chartContext, opts) {
                // Access the selected data point's data
                const selectedDataPoint = opts.w.config.series[opts.seriesIndex].data[opts.dataPointIndex];
                const url = selectedDataPoint.url;

                // Open the hyperlink in a new tab
                if (url) {
                    window.open(url, '_blank');
                }
                }
            }
        },
        plotOptions: {
          heatmap: {
            shadeIntensity: 0.5,
            radius: 0,
            useFillColorAsStroke: false,
            colorScale: {
              ranges: [{
                  from: 0,
                  to: 50,
                  name: 'failure',
                  color: '#FF0000'
                },
                {
                  from: 50,
                  to: 100,
                  name: 'success',
                  color: '#006400'
                }
              ]
            }
          }
        },
        dataLabels: {
          enabled: false
        },
        stroke: {
          width: 3
        },
        tooltip: {
            y: {
                formatter: function(value) {
                    return value == 100 ? "success" : "failure"
                }
            }
        },
        yaxis: {
            labels: {
                style: {
                    fontSize: '10pt'
                }
            }
        }
        };

        var chart = new ApexCharts(document.querySelector("#chart"), options);
        chart.render();

    </script>

    <div id="wrapper">
        <h2>Workflow Version Across Our Repos</h2>
        <div id="grid-table"></div>
    </div>

    <script src="https://unpkg.com/gridjs/dist/gridjs.umd.js"></script>
    <script>
      async function initGrid() {

        const gridData = rawGridData.map(d => [
            d.repo, 
            d.build, 
            d.release, 
            d.tag,
            d.jubilant
        ]);

        // 3. Render the Grid
        new gridjs.Grid({
            columns: [
              "Repository",
              "CI",
              "Release",
              "Tag",
              {
                name: "%Jubilant",
                formatter: function(cell) {
                  parts = cell.split(":");
                  g = parseInt(parts[0])
                  r = parseInt(parts[1]);
                  return gridjs.html(
                    '<div title="'+g+'%" class="pie" style="background: conic-gradient(green 0% '+g+'%, red '+g+'% 100%);"></div>'
                  );
                }
              }
            ],
            data: gridData,
            search: true,
            sort: true,
            pagination: {
                limit: 10
            },
            style: {
                table: { border: '1px solid #ccc' },
                th: { 'background-color': '#f1f1f1', color: '#333', 'text-align': 'center' }
            }
        }).render(document.getElementById("grid-table"));
    }

    initGrid();
    </script>

</body>
</html>